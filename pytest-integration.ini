# pytest configuration for integration tests
# This file provides advanced testing configuration for integration scenarios

[tool:pytest]
minversion = 7.0
addopts = [
    "--strict-markers",
    "--strict-config",
    "--verbose",
    "--tb=short",
    "--cov=src/reflexion",
    "--cov-report=term-missing:skip-covered",
    "--cov-report=html:htmlcov-integration",
    "--cov-report=xml:coverage-integration.xml",
    "--junitxml=test-results-integration.xml",
    "--cov-fail-under=70",
    "--timeout=300",
    "--timeout-method=thread"
]

testpaths = ["tests/integration"]

markers = [
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "integration: marks tests as integration tests",
    "unit: marks tests as unit tests", 
    "benchmark: marks tests as benchmarks",
    "external: marks tests that require external services",
    "llm: marks tests that require LLM API access",
    "database: marks tests that require database connection",
    "redis: marks tests that require Redis connection",
    "docker: marks tests that require Docker",
    "network: marks tests that require network access",
    "gpu: marks tests that require GPU acceleration"
]

filterwarnings = [
    "error",
    "ignore::UserWarning",
    "ignore::DeprecationWarning",
    "ignore::PendingDeprecationWarning"
]

# Integration test specific configuration
log_cli = true
log_cli_level = "INFO"
log_cli_format = "%(asctime)s [%(levelname)8s] %(name)s: %(message)s"
log_cli_date_format = "%Y-%m-%d %H:%M:%S"

# Timeout configuration for long-running integration tests
timeout = 300
timeout_method = "thread"

# Parallel execution configuration (when using pytest-xdist)
# To enable: pip install pytest-xdist
# Run with: pytest -n auto

# Database configuration for integration tests
python_files = ["test_*.py", "*_test.py", "test*.py"]
python_classes = ["Test*", "*Tests"]
python_functions = ["test_*"]

# Environment variables for integration tests
env = [
    "TEST_DATABASE_URL=sqlite:///./test_integration.db",
    "TEST_REDIS_URL=redis://localhost:6379/1", 
    "TEST_ENVIRONMENT=integration",
    "LOG_LEVEL=DEBUG"
]